# 📝 System Prompts 使用指南

## 什麼是 System Prompts？

System Prompts 是給 AI Agents 的額外指示，用來控制它們的行為、輸出風格和必須遵守的規則。透過自訂 System Prompts，你可以：

- ✅ 強制所有輸出使用繁體中文
- ✅ 要求 Agents 遵守特定的格式規範
- ✅ 調整 Agents 的專注重點
- ✅ 加入你的團隊特定要求

## 📋 System Prompts 架構

### 1. 全域規則 (Global Rules)
- 適用於**所有 Agents**
- 用於設定通用規則，如語言、格式、態度等
- 每個 Agent 執行時都會自動套用

**範例：**
```
重要規則（每次執行都必須遵守）：
1. 所有輸出必須使用繁體中文
2. 代碼註解和文檔請使用繁體中文
3. 保持專業和友善的語氣
4. 提供具體可行的建議
5. 引用來源時提供連結
```

### 2. Agent 特定規則
- 針對**特定 Agent** 的額外指示
- 用於微調個別 Agent 的行為
- 與全域規則疊加使用

## 🎯 如何使用

### 方法 1：透過 Web UI 設定（推薦）

1. 啟動 Web UI：`streamlit run app.py`
2. 在側邊欄選擇「System Prompts」
3. 編輯全域規則或特定 Agent 的規則
4. 點擊「💾 儲存」按鈕
5. 下次執行時會自動套用

### 方法 2：直接編輯設定檔

編輯 `custom_prompts.ini` 文件：

```ini
[GLOBAL_RULES]
global_prompt = """
你的全域規則...
"""

[DOCUMENTATION_CREW]
senior_dev_prompt = """
額外指示：
- 特別注意...
"""

tech_writer_prompt = """
額外指示：
- 文檔必須...
"""
```

## 💡 實用範例

### 範例 1：強制使用繁體中文

**全域規則：**
```
重要：所有輸出必須使用繁體中文（Traditional Chinese）
- 代碼註解：繁體中文
- 文檔說明：繁體中文
- 變數命名：使用英文，但註解用繁體中文
```

### 範例 2：針對特定產業

**Documentation Crew - Tech Writer：**
```
額外指示：
- 本專案是金融科技應用，文檔需強調：
  1. 資料安全性說明
  2. 合規性考量
  3. 交易流程的可追溯性
- 範例代碼必須包含錯誤處理
```

### 範例 3：提升代碼品質要求

**Refactoring Crew - Clean Code Reviewer：**
```
額外指示：
- 對代碼品質採取嚴格標準：
  1. 所有函數必須有 docstring
  2. 複雜度超過 10 的函數必須拆分
  3. 類別必須遵守單一職責原則
  4. 建議使用 Type Hints
- 提供具體的重構步驟
```

### 範例 4：技術調研偏好

**Tech Researcher - Strategy Advisor：**
```
額外指示：
- 決策時優先考慮：
  1. 開源方案優於商業方案
  2. 社群活躍度
  3. 長期維護性
  4. 團隊學習成本
- 提供至少兩個備選方案
- 每個建議附上風險評估
```

## 🔄 工作流程

1. **Agent 建立時**
   ```
   原始 Backstory
   + 全域規則
   + Agent 特定規則
   = 最終的 Enhanced Backstory
   ```

2. **執行時套用**
   - 每次執行 Crew 時自動讀取最新設定
   - 無需重新啟動應用程式
   - 支援即時更新

3. **預覽功能**
   - 在 Web UI 的 System Prompts 頁面
   - 使用「預覽增強後的 Backstory」功能
   - 查看最終會傳給 Agent 的完整指示

## 📁 檔案說明

- **custom_prompts.ini**：System Prompts 設定檔
  - 使用 INI 格式
  - 支援多行文字
  - 可手動編輯或透過 Web UI 修改

- **crew_modules/prompt_manager.py**：Prompt 管理模組
  - 負責讀取和儲存設定
  - 提供 API 給其他模組使用
  - 處理 Backstory 增強邏輯

## ⚠️ 注意事項

### 1. Prompt 長度
- 過長的 prompt 可能影響效能
- 建議每個規則保持簡潔明確
- 總長度建議不超過 500 字

### 2. 優先順序
```
Agent 特定規則 > 全域規則 > 原始 Backstory
```

### 3. 語言混用
- 可以在 prompt 中混用中英文
- 建議指示用中文，專業術語用英文
- 例如："必須檢查 SQL Injection 漏洞"

### 4. 測試建議
- 修改 prompt 後建議先用小範例測試
- 觀察 Agent 的輸出是否符合預期
- 逐步調整到最佳狀態

## 🎓 最佳實踐

### ✅ 推薦做法

1. **明確具體**
   ```
   ❌ 寫得好一點
   ✅ 每個函數必須包含 docstring，說明參數類型和返回值
   ```

2. **分點列舉**
   ```
   ✅ 檢查重點：
      1. SQL Injection
      2. XSS 攻擊
      3. CSRF 防護
   ```

3. **提供範例**
   ```
   ✅ 文檔格式參考：
      ## 功能說明
      - 用途：...
      - 參數：...
   ```

### ❌ 避免做法

1. **模糊指示**
   ```
   ❌ 做得專業一點
   ❌ 注意安全
   ```

2. **互相矛盾**
   ```
   ❌ 全域：簡潔為主
       Agent：提供詳細說明
   ```

3. **過度限制**
   ```
   ❌ 必須使用特定格式，絕對不能偏離
   ```

## 🔧 故障排除

### 問題 1：設定沒有生效
**解決方法：**
1. 檢查 `custom_prompts.ini` 檔案是否存在
2. 在 Web UI 點擊「🔄 重新載入設定」
3. 確認格式正確（INI 格式）

### 問題 2：Agent 輸出仍是英文
**解決方法：**
1. 在全域規則明確指定語言
2. 增加強調：「重要：必須使用繁體中文」
3. 在 Agent 特定規則再次強調

### 問題 3：Prompt 太長導致錯誤
**解決方法：**
1. 精簡規則，移除重複內容
2. 合併相似的指示
3. 分離到不同 Agent 的特定規則

## 📞 需要協助？

- 查看 `custom_prompts.ini` 的範例設定
- 使用 Web UI 的預覽功能測試
- 參考本文件的實用範例

---

**提示**：修改 System Prompts 是調整 AI Agents 行為最直接的方式，建議多實驗找出最適合你的設定！
